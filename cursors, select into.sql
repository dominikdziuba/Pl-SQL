--1)

SET SERVEROUTPUT ON



DECLARE



CURSOR AUT IS SELECT * FROM AUTOR;



TYPE AUTORZY IS RECORD



(ID_AUT AUTOR.ID_AUT%TYPE,



NAZWISKO AUTOR.NAZWISKO%TYPE,



IMIE AUTOR.IMIE%TYPE,



KRAJ AUTOR.KRAJ%TYPE



);



V_AUTORZY AUTORZY;



BEGIN



 IF NOT AUT%ISOPEN THEN



    OPEN AUT;



    END IF;



    



LOOP



    FETCH AUT INTO V_AUTORZY;



    EXIT WHEN AUT%NOTFOUND;



    DBMS_OUTPUT.put_line(V_AUTORZY.ID_AUT ||' '|| V_AUTORZY.NAZWISKO ||' '||v_autorzy.IMIE||' '||v_autorzy.KRAJ);



END LOOP;



CLOSE AUT;



END;





--2)



SET SERVEROUTPUT ON



DECLARE



CURSOR AUT IS SELECT * FROM AUTOR;



V_AUTORZY AUTOR%ROWTYPE;



BEGIN



 IF NOT AUT%ISOPEN THEN

 

    OPEN AUT;



    END IF;

LOOP

    FETCH AUT INTO V_AUTORZY;



    EXIT WHEN AUT%NOTFOUND;



    DBMS_OUTPUT.put_line(V_AUTORZY.ID_AUT ||' '|| V_AUTORZY.NAZWISKO ||' '||v_autorzy.IMIE||' '||v_autorzy.KRAJ);



END LOOP;

CLOSE AUT;

END;



--3)



SET SERVEROUTPUT ON



DECLARE



CURSOR AUT IS SELECT * FROM AUTOR;



BEGIN



 FOR LICZNIK IN AUT LOOP

    DBMS_OUTPUT.put_line(LICZNIK.ID_AUT ||' '|| LICZNIK.NAZWISKO ||' '||LICZNIK.IMIE||' '||LICZNIK.KRAJ);

END LOOP;

END;





SET SERVEROUTPUT ON



DECLARE



CURSOR czytelnicy IS 

SELECT INITCAP(IMIE) AS IM, UPPER(NAZWISKO) AS NAZW, INITCAP(MIASTO) AS MI

FROM CZYTELNIK

ORDER BY NAZW DESC;



BEGIN

FOR I IN CZYTELNICY LOOP

    DBMS_OUTPUT.put_line(I.IM ||'*******'||I.NAZW||'******'||I.MI);

    END LOOP;

END;




SET SERVEROUTPUT ON



DECLARE



CURSOR czytelnicy IS 



SELECT CZ.IMIE, CZ.NAZWISKO, EXTRACT(DAY FROM  W.DATA_WYP)AS DZIEN, TO_CHAR(W.DATA_WYP, 'MONTH') AS MIES, K.TYTUL, F.F_NAZWA FROM CZYTELNIK CZ



JOIN WYPOZYCZENIA W ON W.ID_CZYT = CZ.ID_CZYT 



JOIN KSIAZKA K ON K.ID_KS = W.ID_KS



JOIN FORMAT F ON F.ID_FOR = K.ID_FOR



;



BEGIN



FOR I IN CZYTELNICY LOOP



    DBMS_OUTPUT.put_line(I.IMIE ||' '||I.NAZWISKO||' ' || I.DZIEN||' ' ||I.MIES||' ' ||I.TYTUL||' ' ||I.F_NAZWA);



END LOOP;

END;






SET SERVEROUTPUT ON



DECLARE



CURSOR WYPO(P_CENA NUMBER) IS 



SELECT K.TYTUL, A.NAZWISKO, WYD.W_NAZWA, WYP.DATA_ZWR FROM KSIAZKA K, AUTOR A, AUTOR_TYTUL AT, WYDAWNICTWO WYD, WYPOZYCZENIA WYP 



WHERE K.ID_WYD = WYD.ID_WYD AND A.ID_AUT = AT.ID_AUT AND AT.ID_KS = K.ID_KS AND K.CENA>=P_CENA 



AND WYP.ID_KS = K.ID_KS AND SYSDATE BETWEEN WYP.DATA_WYP AND WYP.DATA_ZWR



ORDER BY K.CENA DESC



;



V_TYT VARCHAR2(30);



V_NAZW VARCHAR2(30);



V_WYD VARCHAR2(30);



V_ZWROT DATE;



BEGIN



OPEN WYPO(&X);



LOOP



FETCH WYPO INTO V_TYT, V_NAZW, V_WYD, V_ZWROT;



EXIT WHEN WYPO%NOTFOUND OR WYPO%ROWCOUNT>3;



    DBMS_OUTPUT.put_line(V_TYT ||' '||V_NAZW||' ' || V_WYD||' ' ||V_ZWROT);



    END LOOP;



CLOSE WYPO;



END;






--1)

SET SERVEROUTPUT ON



DECLARE



WYBRANY_FORMAT VARCHAR2(30):= '&NAZWA_FORMATU';



CURSOR FORM IS SELECT COUNT(*) AS LICZBA_KSIAZEK FROM FORMAT F, KSIAZKA K WHERE F_NAZWA = WYBRANY_FORMAT AND K.ID_FOR = F.ID_FOR ;



v_liczba number;



BEGIN



OPEN FORM;



FETCH FORM INTO V_LICZBA;



DBMS_OUTPUT.put_line('Liczba książek w formacie ' || wybrany_format || ': ' || v_liczba);



CLOSE FORM;



END;



--2)

SET SERVEROUTPUT ON



DECLARE



CURSOR FORM(WYBRANY_FORMAT VARCHAR2) IS SELECT COUNT(*) AS LICZBA_KSIAZEK FROM FORMAT F, KSIAZKA K WHERE F_NAZWA = WYBRANY_FORMAT AND K.ID_FOR = F.ID_FOR ;

v_liczba number;



BEGIN



OPEN FORM('&NAZWA_FORMATU');



FETCH FORM INTO V_LICZBA;



DBMS_OUTPUT.put_line('Liczba książek w wybranym formacie: ' || v_liczba);



CLOSE FORM;

END;








--1)

DECLARE



CURSOR PODWYZKA IS SELECT TYTUL, W_NAZWA, CENA FROM KSIAZKA K, WYDAWNICTWO W WHERE K.ID_WYD = W.ID_WYD FOR UPDATE;







ZMIANA NUMBER(5,2);



BEGIN 



FOR I IN PODWYZKA LOOP



IF I.W_NAZWA = 'Litera' THEN ZMIANA :=1.1;



ELSE ZMIANA :=1.05; END IF;



UPDATE KSIAZKA SET CENA = CENA * ZMIANA



WHERE CURRENT OF PODWYZKA;

END LOOP;



END;



--2)

SET SERVEROUTPUT ON

DECLARE



CURSOR PODWYZKA IS SELECT ID_KS, TYTUL, W_NAZWA, CENA FROM KSIAZKA K, WYDAWNICTWO W WHERE K.ID_WYD = W.ID_WYD  FOR UPDATE;



ZMIANA NUMBER(5,2);

V_CENA NUMBER(5,2);

BEGIN 



FOR I IN PODWYZKA LOOP



IF I.W_NAZWA = 'Litera' THEN ZMIANA:=1.1;



ELSE ZMIANA:=1.05; END IF;

UPDATE KSIAZKA SET CENA = CENA *ZMIANA WHERE I.ID_KS = KSIAZKA.ID_KS RETURNING CENA INTO V_CENA;

DBMS_OUTPUT.PUT_LINE('Zaktualizowano cenę książki ' || I.tytul || ' na ' || V_CENA);



END LOOP;



END;

